echo "ğŸ” Running pre-commit checks..."

# Run lint-staged
npx lint-staged

# Run tests with coverage
echo ""
echo "ğŸ“Š Running tests with coverage check..."
npm test -- --coverage --watchAll=false --passWithNoTests --silent

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Tests failed or coverage thresholds not met!"
  echo "   Required: Branches 58%, Functions 70%, Lines 69.5%, Statements 70%"
  echo "   Run 'npm test -- --coverage' to see detailed coverage report"
  exit 1
fi

# Regenerate documentation indexes if markdown files changed
CHANGED_MD_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.md$' || true)
if [ -n "$CHANGED_MD_FILES" ]; then
  echo "ğŸ“š Regenerating documentation indexes..."
  npm run docs:generate
  git add DOCUMENTATION_INDEX.md docs/INDEX.md
fi

echo "âœ… Pre-commit checks completed successfully!"
